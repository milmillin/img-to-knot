!function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){const n=r(1),o=document.getElementById("inputFile"),i=document.getElementById("imgOriginal"),s=document.getElementById("canvasOutput"),a=document.getElementById("inputWidth"),d=document.getElementById("inputThreshold"),h=document.getElementById("inputKnots"),l=document.getElementById("inputBlack"),c=document.getElementById("btnDownload"),f={imageLoaded:!1,imageDataGrayscale:null,knotData:null,desiredWidth:+a.value,threshold:+d.value,numKnots:+h.value,knotOnBlack:l.checked},u=()=>{const e=f.imageDataGrayscale,t=e.width,r=e.height,n=f.threshold,o=new Array(r);for(var i=0;i<r;i++){o[i]=new Array(t);for(var a=0;a<t;a++)o[i][a]=e.data[i*t*4+4*a]>n}f.knotData={width:t,height:r,data:o},(()=>{const e=f.knotData;s.width=16*e.width,s.height=16*e.height;const t=s.getContext("2d");for(let r=0;r<e.height;r++)for(let n=0;n<e.width;n++){const o=e.data[r][n]?255:0;t.fillStyle=`rgba(${o},${o},${o},1)`,t.fillRect(16*n,16*r,16,16)}})()},p=()=>{const e=f.desiredWidth/i.width,t=f.desiredWidth,r=Math.ceil(i.height*e),n=new OffscreenCanvas(t,r).getContext("2d");n.scale(e,e),n.drawImage(i,0,0);const o=n.getImageData(0,0,t,r),s=o.data;for(var a=0;a<s.length;a+=4){const e=.3*s[a]+.59*s[a+1]+.11*s[a+2];s[a]=e,s[a+1]=e,s[a+2]=e}f.imageDataGrayscale=o,u()};o.addEventListener("change",e=>{if(e.target.files[0]){const t=new FileReader;t.onload=e=>{i.onload=()=>{console.log("Image Successfullyl Loaded"),f.imageLoaded=!0,p()},i.src=e.target.result},t.readAsDataURL(e.target.files[0])}else f.imageLoaded=!1}),a.addEventListener("change",e=>{f.desiredWidth=+e.target.value,f.imageLoaded&&p()}),d.addEventListener("change",e=>{f.threshold=+e.target.value,f.imageLoaded&&u()}),h.addEventListener("change",e=>{f.numKnots=+e.target.value}),l.addEventListener("change",e=>{f.knotOnBlack=e.target.checked}),c.addEventListener("click",e=>{if(f.imageLoaded){const e=n(f.knotData,f.knotOnBlack,f.numKnots),t=document.createElement("a");t.style="display: none";const r=new Blob([e],{type:"text/plain"}),o=window.URL.createObjectURL(r);t.href=o,t.download="my-knot.knitout",document.body.appendChild(t),t.click(),document.body.removeChild(t),window.URL.revokeObjectURL(o)}else alert("Please choose an image first")})},function(e,t,r){var n=r(2);e.exports=(e,t,r)=>{var o=e.height,i=e.width,s=e.data;const a=new n.Writer({carriers:["1","2","3","4","5","6","7","8","9","10"]});a.addHeader("Machine","SWG091N2"),a.addHeader("Gauge","15");const d=(e,t,r,n,o,i)=>{const s="f"===r?"b":"f";if("+"===t)for(let t=0;t<i;t++)e.miss("+","f"+(n+1),o),e.xfer(r+n,s+n),e.miss("-","f"+(n-1),o),e.xfer(s+n,r+n);else for(let t=0;t<i;t++)e.miss("-","f"+(n-1),o),e.xfer(r+n,s+n),e.miss("+","f"+(n+1),o),e.xfer(s+n,r+n)};a.inhook("5");for(var h=i;h>0;h--)h%2==0?a.tuck("-","f"+h,"5"):a.miss("-","f"+h,"5");for(h=1;h<=i;h++)h%2!=0?a.tuck("+","f"+h,"5"):a.miss("+","f"+h,"5");a.releasehook("5");for(var l=0;l<o;l++){const e=o-l-1;if(l%2==0)for(h=i;h>0;h--){const n=h-1;s[e][n]!==t&&d(a,"-","f",h,"5",r),a.knit("-","f"+h,"5")}else for(h=1;h<=i;h++){const n=h-1;s[e][n]!==t&&d(a,"+","f",h,"5",r),a.knit("+","f"+h,"5")}}return a.outhook("5"),a.toKnitoutString()}},function(e,t,r){"use strict";var n=function(e){if(this.carriers={},this.needles={},this.racking=0,this._carriers=[],this._operations=[],this._headers=[],void 0!==e&&"carriers"in e){if(!Array.isArray(e.carriers))throw new Error("opts.carriers should be an array of carrier names");e.carriers.forEach(e=>{if("string"!=typeof e||-1!==e.indexOf(" "))throw new Error("Carrier names must be strings that do not contain the space character (' ').")}),this._carriers=e.carriers.slice()}else console.warn("WARNING: options object passed to knitout.Writer does not contain a 'carriers' member. Will assume a default carrier layout (a single carrier named \"A\")"),this._carriers=["A"];this._headers.push(";;Carriers: "+this._carriers.join(" "))};function o(e){if(console.assert(Array.isArray(e)),0===e.length)throw new Error("Direction missing.");if("+"!==e[0]&&"-"!==e[0])throw new Error("Direction should be '+' or '-'.");return e.shift()}n.prototype.addHeader=function(e,t){if(void 0===e||void 0===t)throw new Error("Writer.addHeader should be called with a name and a value");if("string"!=typeof e||-1!==e.indexOf(": "))throw new Error("Header names must be strings that don't contain the sequence ': '");if("string"!=typeof t||-1!==t.indexOf("\n"))throw new Error("Header values must be strings that do not contain the LF character ('\\n').");if("Carriers"===e)throw new Error("Writer.addHeader can't set Carriers header (use the 'carriers' option when creating the writer instead).");if("Machine"===e);else if("Gauge"===e);else if("Position"===e);else if(e.startsWith("Yarn-")){let t=e.substr(5);-1===this._carriers.indexOf(t)&&console.warn("Warning: header '"+e+"' mentions a carrier that isn't in the carriers list.")}else e.startsWith("X-")||console.warn("Warning: header name '"+e+"' not recognized; header will still be written.");this._headers.push(";;"+e+": "+t)},n.prototype.addRawOperation=function(e){console.warn("Warning: operation added to list as is(string), no error checking performed."),this._operations.push(e)};const i=/^([fb]s?)(-?\d+)$/,s=/^[fb]s?$/;function a(e){if(console.assert(Array.isArray(e)),0===e.length)throw new Error("Needle missing.");let t,r;if("string"==typeof e[0]&&s.test(e[0])){if(e.length<2||!Number.isInteger(e[1]))throw new Error("Expecting bed name to be followed by a needle number.");t=e.shift(),r=e.shift()}else if("string"==typeof e[0]){let n=e[0].match(i);if(null===n)throw new Error("String '"+e[0]+"' does not look like a compound bed+needle string.");t=n[1],r=parseInt(n[2]),e.shift()}else if(Array.isArray(e[0])){if(2!==e[0].length||"string"!=typeof e[0][0]||!s.test(e[0][0])||!Number.isInteger(e[0][1]))throw new Error('Bed+needle array should look like ["f", 12].');t=e[0][0],r=e[0][1],e.shift()}else{if("object"!=typeof e[0])throw new Error('Expecting bed+needle as name+number ("fs", 6), string ("b-2"), array (["f", 6]), or object ({bed:"bs", needle:12}). Got \''+JSON.stringify(e)+"'");if(!("bed"in e[0])||"string"!=typeof e[0].bed||!s.test(e[0].bed))throw new Error("Bed+needle object should have a 'bed' member string naming the bed.");if(!("needle"in e[0])||!Number.isInteger(e[0].needle))throw new Error("Bed+needle object should have a 'needle' member integer.");t=e[0].bed,r=e[0].needle,e.shift()}return{bed:t,needle:r}}function d(e,t){let r=[];return r=1===e.length&&Array.isArray(e[0])?e.shift().slice():e.splice(0,e.length).slice(),r.forEach((function(e,t){let n=e.split(" "),o=!0;n.forEach((function(e,n){""!=e&&(o?(r[t]=e,o=!1):r.push(e))}))})),r.forEach((function(e,t){let n=e.split(","),o=!0;n.forEach((function(e,n){""!=e&&(o?(r[t]=e,o=!1):r.push(e))}))})),r.forEach((function(e){if(-1===t.indexOf(e))throw new Error("Invalid carrier name '"+e+"'")})),r}function h(e){return!("number"!=typeof e||!Number.isFinite(e)||Number.isNaN(e))}n.prototype.in=function(...e){let t=d(e,this._carriers);if(0===t.length)throw new Error("It doesn't make sense to 'in' on an empty carrier set.");t.forEach((function(e){if(e in this.carriers)throw new Error("Carrier '"+e+"' is already in.");this.carriers[e]={hook:!1}}),this),this._operations.push("in "+t.join(" "))},n.prototype.inhook=function(...e){let t=d(e,this._carriers);if(0===t.length)throw new Error("It doesn't make sense to 'inhook' on an empty carrier set.");t.forEach((function(e){if(e in this.carriers)throw new Error("Carrier '"+e+"' is already in.");this.carriers[e]={hook:!0}}),this),this._operations.push("inhook "+t.join(" "))},n.prototype.releasehook=function(...e){let t=d(e,this._carriers);if(0===t.length)throw new Error("It doesn't make sense to 'releasehook' on an empty carrier set.");t.forEach((function(e){if(!(e in this.carriers))throw new Error("Carrier '"+e+"' isn't in.");if(!this.carriers[e].hook)throw new Error("Carrier '"+e+"' isn't in the hook.");this.carriers[e].hook=!1}),this),this._operations.push("releasehook "+t.join(" "))},n.prototype.out=function(...e){let t=d(e,this._carriers);if(0===t.length)throw new Error("It doesn't make sense to 'out' on an empty carrier set.");t.forEach((function(e){if(!(e in this.carriers))throw new Error("Carrier '"+e+"' isn't in.");delete this.carriers[e]}),this),this._operations.push("out "+t.join(" "))},n.prototype.outhook=function(...e){let t=d(e,this._carriers);if(0===t.length)throw new Error("It doesn't make sense to 'outhook' on an empty carrier set.");t.forEach((function(e){if(!(e in this.carriers))throw new Error("Carrier '"+e+"' isn't in.");delete this.carriers[e]}),this),this._operations.push("outhook "+t.join(" "))},n.prototype.stitch=function(e,t){if(!h(e)||!h(t))throw new Error("Stitch L and T values must be finite numbers.");this._operations.push("stitch "+e.toString()+" "+t.toString())},n.prototype.stitchNumber=function(e){if(!(Number.isInteger(e)&&e>0))throw new Error("Stitch numbers are positive integer values.");this._operations.push("x-stitch-number "+e.toString())},n.prototype.fabricPresser=function(e){"auto"===e?this._operations.push("x-presser-mode auto"):"on"===e?this._operations.push("x-presser-mode on"):"off"===e?this._operations.push("x-presser-mode off"):console.warn("Ignoring presser mode extension, unknown mode "+e+". Valid modes: on, off, auto")},n.prototype.rack=function(e){if(!h(e))throw new Error("Racking values must be finite numbers.");this.racking=e,this._operations.push("rack "+e.toString())},n.prototype.knit=function(...e){let t=o(e),r=a(e),n=d(e,this._carriers);n.length>0?this.needles[r.bed+r.needle.toString()]=!0:delete this.needles[r.bed+r.needle.toString()],this._operations.push("knit "+t+" "+r.bed+r.needle.toString()+" "+n.join(" "))},n.prototype.tuck=function(...e){let t=o(e),r=a(e),n=d(e,this._carriers);this.needles[r.bed+r.needle.toString()]=!0,this._operations.push("tuck "+t+" "+r.bed+r.needle.toString()+" "+n.join(" "))},n.prototype.split=function(...e){let t=o(e),r=a(e),n=a(e),i=d(e,this._carriers);r.bed+r.needle.toString()in this.needles&&(this.needles[n.bed+n.needle.toString()]=!0,delete this.needles[r.bed+r.needle.toString()]),i.length>0&&(this.needles[r.bed+r.needle.toString()]=!0),this._operations.push("split "+t+" "+r.bed+r.needle.toString()+" "+n.bed+n.needle.toString()+" "+i.join(" "))},n.prototype.miss=function(...e){let t=o(e),r=a(e),n=d(e,this._carriers);if(0===n.length)throw new Error("It doesn't make sense to miss with no carriers.");this._operations.push("miss "+t+" "+r.bed+r.needle.toString()+" "+n.join(" "))},n.prototype.drop=function(...e){let t=a(e);if(0!==e.length)throw new Error("drop only takes a bed+needle");delete this.needles[t.bed+t.needle.toString()],this._operations.push("drop "+t.bed+t.needle.toString())},n.prototype.amiss=function(...e){let t=a(e);if(0!==e.length)throw new Error("amiss only takes a bed+needle");this._operations.push("amiss "+t.bed+t.needle.toString())},n.prototype.xfer=function(...e){let t=a(e),r=a(e);if(0!==e.length)throw new Error("xfer only takes two bed+needles");t.bed+t.needle.toString()in this.needles&&(this.needles[r.bed+r.needle.toString()]=!0,delete this.needles[t.bed+t.needle.toString()]),this._operations.push("xfer "+t.bed+t.needle.toString()+" "+r.bed+r.needle.toString())},n.prototype.comment=function(e){e.split("\n").forEach((function(e){for(;e.startsWith(";");)console.warn("Warning: comment starts with ; use addHeader for adding header comments."),e=e.substr(1,e.length);this._operations.push(";"+e.toString())}),this)},n.prototype.pause=function(e){this.comment(e),this._operations.push("pause")},n.prototype.toKnitoutString=function(){return";!knitout-2\n"+this._headers.join("\n")+"\n"+this._operations.join("\n")+"\n"},n.prototype.write=function(e){let t=";!knitout-2\n"+this._headers.join("\n")+"\n"+this._operations.join("\n")+"\n";try{r(3).writeFileSync(e,t)}catch(e){console.warn("Can't load 'fs'. Did not write file.")}return t},e.exports.Writer=n},function(e,t){}]);